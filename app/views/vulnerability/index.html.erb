<style>
    .vuln {
      margin: 20px;
    }
  </style>

<div class="vuln">
    <h2>ReportingPortalGPT</h2>

    <div class="row">
      <div class="top-nav col-md-12">
        <%= form_with url:vuln_allrefresh_path,:html => {:class => 'float-start'} do |form| %>
          <div class="form-button mt-3">
            <button type="submit" class="mb-2 btn mr-3 btn-light">Refresh via ChatGPT</button>

            <span class="align-text-top" role="button">
            <i data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="bottom" 
            data-bs-title="<ul class=custom-tk>
              <li><small>Refresh all write ups and remediation using <a href=#>GPT4</a></small></li>
              <li><small>Generate OWASP 2021, NIST 5 point Rating, CVSS Rating, CVSS 3 and CWE  rating.</small></li>
            </ul>" class="bi bi-info-circle"></i></span>
          </div>
        <% end %>

        
        <%= form_with(url:vuln_export_path,method:'get',data: {turbo: false}, :html => {:class => 'float-end'}) do |f| %>
          <div class="btn-group mt-3">
            <button type="button" class="btn btn-warning">Export as</button>
            <button type="button" class="btn btn-warning dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
              <span class="visually-hidden">Toggle Dropdown</span>
            </button>
        
            <ul class="dropdown-menu">
              <li><button class="dropdown-item" type="submit" name="export" value="json">JSON <small>(.json)</small></button></li>
              <li><button class="dropdown-item" type="submit" name="export" value="csv">CSV <small>(.csv)</small></button></li>
            </ul>
          </div>
        <% end %>

        
        
        <%= form_with(url:vuln_filter_approve_path,method:'get',data: {turbo: false}, :html => {:class => 'float-end me-3'}) do |f| %>
          <div class="dropdown mt-3">
            <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
              Approved By
            </button>
            <ul class="dropdown-menu">
              <li>
                <div class="dropdown-item">
                    <div class="form-check">
                      <input type="checkbox" <%= "checked" if params[:approved_by] and params[:approved_by][:hamza]=='on' %> name="approved_by[hamza]" id="approved_by_hamza" class='form-check-input'/>
                      <label class="form-check-label" style="width: 100%;" for="approved_by_hamza">
                        <small class="align-text-bottom">Hamza</small>
                      </label>
                    </div>
                </div>
              </li>
              <li>
                <div class="dropdown-item">
                  <div class="form-check" >
                    <input type="checkbox" <%= "checked" if params[:approved_by] and params[:approved_by][:omair]=='on' %> name="approved_by[omair]" id="approved_by_omair" class='form-check-input'/>
                    <label class="form-check-label" style="width: 100%;" for="approved_by_omair">
                      <small class="align-text-bottom">Omair</small>
                    </label>
                  </div>
                </div>
              </li>
              <li>
                <div class="dropdown-item d-grid gap-2 col-6 mx-auto">
                  <button class="btn btn-primary btn-sm" type="submit">Filter</button>
                </div>
              </li>
            </ul>
          </div>
        <% end %>

        
      </div>
    </div>
    
    <hr/>

    <% flash.each do |type, msg| %>
      <div>
        <div class="alert alert-success" role="alert">
          <h4 class="alert-heading">Task Started</h4>
          <p><%= msg %></p>
          <hr>
          <p class="mb-0"><b>Note</b> It might take some time to update all the contens. So please be patient as it requires some processing.</p>
        </div>
      </div>
    <% end %>

    <div class="col-md-12 table-responsive">
    <table class="table table-bordered table-hover">
    <thead>
        <tr>
          <th>#</th>
          <!-- <th>Plugin ID</th> -->
          <th>Title</th>
          <th>Revision</th>
          <th>CWE</th>
          <th>OWASP Top 10</th>
          <th>CVSS Rating</th>
          <th>CVSS Vector</th>
          <th>CVSS3 Rating</th>
          <th>CVSS3 Vector</th>
          <th>Risk Factor</th>
          <th>Damage</th>
          <th>Discoverability</th>
          <th>Exploitability Ease</th>
          <th>Port</th>
          <th>Protocol</th>
          <th>Approved</th>
          <th>Likelihood</th>
          <th>Impact</th>
        </tr>
    </thead>
    <tbody>
        <% @vulnerabilities.each do |vulnerability| %>
        <tr>
            <td><a href="/vulnerability/<%= vulnerability['id'] %>"><%= vulnerability['id'] %></a></td>
            <!-- <td><%= vulnerability['plugin_id'] %></td> -->
            <td><a href="/vulnerability/<%= vulnerability['id'] %>"><%= vulnerability['title'] %></a></td>
            <!-- <td><%= vulnerability['title'] %></td> -->
            <td><%= time_ago_in_words(vulnerability['updated_at']) %></td>
            <td><%= vulnerability['cwe'] %></td>
            <td><%= vulnerability['owasp'] %></td>
            <td><%= vulnerability['cvss_rating'] %></td>
            <td><%= vulnerability['cvss2_vector'] %></td>
            <td><%= vulnerability['cvss3_rating'] %></td>
            <td><%= vulnerability['cvss3_vector'] %></td>
            <td><%= vulnerability['risk_factor'] %></td>
            <td><%= vulnerability['damage'] %></td>
            <td><%= vulnerability['discoverability'] %></td>
            <td><%= vulnerability['exploitability_ease'] %></td>
            <td><%= vulnerability['port'] %></td>
            <td><%= vulnerability['protocol'] %></td>
            <td><%= vulnerability['approved'] %></td>
            <td><%= vulnerability['v_likelihood'] %></td>
            <td><%= vulnerability['v_impact'] %></td>

        </tr>
        <% end %>
    </tbody>
    </table>
   </div>
</div>