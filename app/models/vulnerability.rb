require 'csv'

class Vulnerability < ApplicationRecord
    def self.to_csv
        attributes = %w[plugin_id title description vuln_type poc impact remediation cwe owasp cvss2_base_score cvss2_temporal_score cvss2_vector cvss2_temporal_vector risk_factor damage reproducability discoverability exploitability_ease port protocol approved v_likelihood v_impact steps_to_reproduce likelihood_text]

        CSV.generate(headers: true) do |csv|
            csv << attributes
            all.each do |vuln|
                csv << attributes.map{ |attr| vuln.send(attr) }
            end
        end
    end
end